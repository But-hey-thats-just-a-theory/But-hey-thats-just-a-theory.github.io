@inject GameState GameState
@implements IDisposable

@if (Item != null)
{
    
    <div style="@(GetBackground())margin:2px;height:50px;width:50px;position:relative;box-sizing: border-box;border-radius:0.25rem;"
         >
        @if (ShowAmount)
        {
            <div style="position:absolute;margin-left:2px;margin-top:-2px;color:white">@GetAmount()</div>
        }
        <img style="height: 46px;width: 46px;@GetMargin()" src="/data/Images/@(Item.Icon).png"
             onmouseover="@(new Action<MouseEventArgs>(e => GameState.ShowTooltip(e, GetTooltipTitle(), Item.Description)))"
             onmouseout="@(new Action(() => GameState.HideTooltip()))" />
    </div>
}
else
{
    <div style="border:solid black 1px;margin:2px;height:50px;width:50px;background-color:gray;border-radius:0.25rem"></div>
}
@code {
    [Parameter]
    public GameItem Item { get; set; }
    [Parameter]
    public bool ShowAmount { get; set; }
    [Parameter]
    public Inventory Inventory { get; set; }
    [Parameter]
    public bool IsSelected { get; set; }

    private string GetAmount()
    {
        if (ShowAmount)
        {
            if(Inventory == null)
            {
                return "" + Player.Instance.Inventory.GetNumberOfItem(Item);
            }
            return "" + Inventory.GetNumberOfItem(Item);
        }
        return "";
    }
    private string GetBackground()
    {
        string style = "";
        string border = "border:solid black 1px;";
        if (IsSelected)
        {
            border = "border:solid white 2px;";
            style = "background-color:lightgreen;";
        }
        else
        {
            if (Item != null)
            {
                if (Item.Category == "Fishing")
                {
                    style = "background-color:skyblue;";
                }
                else if (Item.Category == "Logs")
                {
                    style = "background-color:sandybrown;";
                }
                else if (Item.Category == "Ores")
                {
                    style = "background-color:brown;";
                }
                else if (Item.Category == "Sushi")
                {
                    style = "background-color:lightgray;";
                }
                else if (Item.Category == "WoodworkingItems")
                {
                    style = "background-color:burlywood;";
                }
            }
            else
            {
                style = "background-color:darkgray;";
            }
        }
        if (Item != null && Item.IsEquipped)
        {
            border = "border:solid 2px lightgreen;";
        }
        return style + border;
    }
    private string GetMargin()
    {
        if (IsSelected)
        {
            return "margin:1px;";
        }
        return "margin:2px;";
    }
    public string GetTooltipTitle()
    {
        string tip = "";
        if (Bank.Instance.IsBanking)
        {
            if(Inventory == Bank.Instance.Inventory)
            {
                if (Bank.Instance.Amount == int.MaxValue)
                {
                    tip = "Withdraw All " + Item.Name;
                }
                else
                {
                    tip = "Withdraw " + Bank.Instance.Amount + " " + Item.Name;
                }
            }
            else
            {
                if (Bank.Instance.Amount == int.MaxValue)
                {
                    tip = "Deposit All " + Item.Name;
                }
                else
                {
                    tip = "Deposit " + Bank.Instance.Amount + " " + Item.Name;
                }
            }


        }
        else
        {
            tip = Item.Name;
        }

        return tip;
    }

    protected override void OnInitialized()
    {
        GameState.StateChanged += OnGameStateChanged;
    }
    public void Dispose()
    {
        GameState.HideTooltip();
        GameState.StateChanged -= OnGameStateChanged;
    }
    void OnGameStateChanged(object sender, EventArgs e) => StateHasChanged();
}
